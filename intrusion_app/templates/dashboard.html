{% load alerts_extras %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Info IDS | Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-slate-900 to-gray-800 text-white min-h-screen font-sans flex">

  <!-- Sidebar -->
  <aside class="w-64 bg-slate-900/95 backdrop-blur p-6 flex flex-col space-y-4 border-r border-gray-700 shadow-lg">
      <h1 class="text-2xl font-bold text-cyan-400 mb-6">Info IDS</h1>
      <nav class="flex flex-col space-y-6">
          <a href="#" class="flex items-center px-4 py-3 rounded-xl hover:bg-cyan-500/20 hover:border-l-4 hover:border-cyan-400 transition">
              Dashboard
          </a>
          <a href="#" class="flex items-center px-4 py-3 rounded-xl hover:bg-cyan-500/20 hover:border-l-4 hover:border-cyan-400 transition">
              Upload Data
          </a>
          <a href="#" class="flex items-center px-4 py-3 rounded-xl hover:bg-cyan-500/20 hover:border-l-4 hover:border-cyan-400 transition">
              Reports
          </a>
          <a href="#" class="flex items-center px-4 py-3 rounded-xl hover:bg-cyan-500/20 hover:border-l-4 hover:border-cyan-400 transition">
              Settings
          </a>
          <a href="#" class="flex items-center px-4 py-3 rounded-xl hover:bg-cyan-500/20 hover:border-l-4 hover:border-cyan-400 transition">
              Logout
          </a>
      </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 space-y-8">

      <!-- Header -->
      <header class="bg-slate-800/90 p-6 rounded-2xl shadow-lg text-center">
          <h2 class="text-4xl font-extrabold text-cyan-400 tracking-wide">AI Intrusion Detection System</h2>
          <p class="mt-2 text-gray-300">Monitoring Network Threats in Real-Time</p>
      </header>

      <!-- Key Stats -->
      <section class="grid grid-cols-1 md:grid-cols-4 gap-6">
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md hover:scale-105 transition">
              <h3 class="text-lg font-bold text-cyan-400">Active Alerts</h3>
              <p class="mt-2 text-4xl font-extrabold">{{ recent_alerts|length }}</p>
              <p class="text-gray-400 text-sm">Last 24h</p>
          </div>
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md hover:scale-105 transition">
              <h3 class="text-lg font-bold text-cyan-400">Network Traffic</h3>
              <p class="mt-2 text-4xl font-extrabold">1.8 GB</p>
              <p class="text-gray-400 text-sm">Today</p>
          </div>
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md hover:scale-105 transition">
              <h3 class="text-lg font-bold text-cyan-400">Accuracy</h3>
              <p class="mt-2 text-4xl font-extrabold">97%</p>
              <p class="text-gray-400 text-sm">ML Model</p>
          </div>
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md hover:scale-105 transition">
              <h3 class="text-lg font-bold text-cyan-400">Uptime</h3>
              <p class="mt-2 text-4xl font-extrabold">99.9%</p>
              <p class="text-gray-400 text-sm">This Week</p>
          </div>
      </section>

      <!-- Charts Grid -->
      <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Pie Chart -->
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md">
              <h3 class="text-xl font-bold text-cyan-400 mb-4">Attack Distribution</h3>
              <canvas id="attackPie"></canvas>
          </div>

          <!-- Line Chart -->
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md">
              <h3 class="text-xl font-bold text-cyan-400 mb-4">Alerts Over Time</h3>
              <canvas id="alertsLine"></canvas>
          </div>

          <!-- Bar Chart -->
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md">
              <h3 class="text-xl font-bold text-cyan-400 mb-4">Attack Types</h3>
              <canvas id="attackBar"></canvas>
          </div>

          <!-- Radar Chart -->
          <div class="bg-slate-800 p-6 rounded-2xl shadow-md">
              <h3 class="text-xl font-bold text-cyan-400 mb-4">Threat Radar</h3>
              <canvas id="attackRadar"></canvas>
          </div>
      </section>

      <!-- Logs -->
      <section class="bg-slate-800 p-6 rounded-2xl shadow-md">
          <h3 class="text-xl font-bold text-cyan-400 mb-4">Recent Alerts</h3>
          <table class="w-full text-left border-collapse">
              <thead>
                  <tr class="text-gray-400 text-sm border-b border-gray-700">
                      <th class="p-2">Time</th>
                      <th class="p-2">Source IP</th>
                      <th class="p-2">Attack</th>
                      <th class="p-2">Severity</th>
                  </tr>
              </thead>
              <tbody>
                  {% for alert in recent_alerts %}
                  <tr class="hover:bg-slate-700 transition">
                      <td class="p-2">{{ alert.timestamp|date:"H:i A" }}</td>
                      <td class="p-2">{{ alert.source_ip }}</td>
                      <td class="p-2">{{ alert.attack_type }}</td>
                      <td class="p-2 
                          {% if alert.severity == "High" or alert.severity == "Critical" %}text-red-500
                          {% elif alert.severity == "Medium" %}text-yellow-400
                          {% else %}text-green-400{% endif %} font-bold">
                          {{ alert.severity }}
                      </td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </section>

      <!-- Status -->
      <section class="text-center">
          <div class="bg-cyan-400 text-gray-900 p-6 rounded-2xl shadow-lg animate-pulse">
              <h3 class="text-2xl font-bold">System Status: ✅ Secure</h3>
          </div>
      </section>

      <!-- Footer -->
      <footer class="bg-slate-900 p-4 text-center text-gray-400 text-sm rounded-2xl">
          © 2025 Info IDS | AI-Powered Intrusion Detection System
      </footer>
  </main>

  <!-- Chart.js Config -->
  <script>
      // Attack Distribution Pie Chart
      const attackLabels = {{ attack_distribution|pluck:"attack_type"|safe }};
      const attackData = {{ attack_distribution|pluck:"count"|safe }};
      new Chart(document.getElementById('attackPie'), {
          type: 'pie',
          data: {
              labels: attackLabels,
              datasets: [{
                  data: attackData,
                  backgroundColor: ['#ef4444','#f59e0b','#3b82f6','#8b5cf6','#10b981']
              }]
          }
      });

      // Alerts Over Time Line Chart
      const alertsLabels = {{ alerts_over_time|pluck:"day"|safe }};
      const alertsData = {{ alerts_over_time|pluck:"count"|safe }};
      new Chart(document.getElementById('alertsLine'), {
          type: 'line',
          data: {
              labels: alertsLabels,
              datasets: [{
                  label: 'Alerts',
                  data: alertsData,
                  borderColor: '#06b6d4',
                  backgroundColor: 'rgba(6,182,212,0.2)',
                  fill: true,
                  tension: 0.4
              }]
          }
      });

      // Attack Types Bar Chart
      new Chart(document.getElementById('attackBar'), {
          type: 'bar',
          data: {
              labels: attackLabels,
              datasets: [{
                  label: 'Count',
                  data: attackData,
                  backgroundColor: '#3b82f6'
              }]
          }
      });

      // Threat Radar Chart
      new Chart(document.getElementById('attackRadar'), {
          type: 'radar',
          data: {
              labels: attackLabels,
              datasets: [{
                  label: 'Threat Level',
                  data: attackData,
                  borderColor: '#f59e0b',
                  backgroundColor: 'rgba(245,158,11,0.2)'
              }]
          }
      });
  </script>

</body>
</html>
